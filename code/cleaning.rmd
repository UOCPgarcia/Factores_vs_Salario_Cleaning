---
title: "Limpieza y análisis de datos"
author: "Adrià Cortés Andrés - MPilar García Ruiz"
date: "12/12/2021"
output:
  html_document:
    toc: yes
    toc_depth: '3'
    df_print: paged
lang: es-ES
---

## 0.- Preliminares    
    
Esta práctica se ha realizado bajo el contexto de la asignatura Tipología y ciclo de vida de los datos (M2.851), perteneciente al Máster en Ciencia de Datos de la Universitat Oberta de Catalunya (UOC). En ella, se aplican técnicas de limpieza y análisis de datos mediante el lenguaje de programación R con el fin de limpiar y analizar un conjunto de datos para después estudiar la probabilidad de alcanzar (o no) cierto umbral de salario en base a los factores personales descritos en el dataset.
    
### Miembros del equipo    
    
El proyecto ha sido realizado de forma conjunta por:    

- Adrià Cortés Andrés    
- María Pilar Garcia Ruiz    
    
## 1.- Descripción del dataset. ¿Por qué es importante y qué pregunta/problema pretende responder?    
    
El conjunto de datos ha sido obtenido de la plataforma kaggle, en la url

![Kaggle: Your Machine Learning and Data Science Community]
https://www.kaggle.com/ddmasterdon/income-adult?select=adult_data.csv    
    
Las variables con las que cuenta el dataset son las siguientes:     
    
|Variables|Tipo|Descripción|
|:---:|:---:|:---:|
|Age|Numérico|Edad de la persona|
|workclass|Texto|Clase de empleado. Campo categorizado.|
|fnlwgt|Numérico|Peso final dado por la oficina que ha recogido los datos y que da el número de unidades en la población objetivo en base a una fórmula no facilitada-|
|education|Texto|Nivel de estudios. Campo categorizado|
|education-num|Texto|Años dedicados a los estudios|
|marital-status|Texto|Situación sentimental. Campo categorizado|
|occupation|Texto|Trabajo actual|
|relationship|Texto|Relación familiar actual. Campo categorizado|
|race|Texto|Raza. Campo categorizado|
|sex|Texto|Sexo. Campo categorizado|
|capital-gain|Numérico|Ganancia de capital|
|capital-loss|Numérico|Pérdida de capital|
|hours-per-week|Numérico|Horas de trabajo por semana|
|native-country|Texto|Nacionalidad. Campo categorizado|
|salary|Lógico|Salario|
    
Se escoge este dataset para ver si se puede estudiar qué  salario puede alcanzar una persona en base a su pertenencia a un grupo demográfico, con las características descritas en el conjunto de datos. 
Se establece el estudio en torno a un umbral salarial predeterminado. Las personas que no alcanzan un determinado umbral de sueldo tienen una peor calidad de vida, se encuentran con más dificultad para hacer frente a cualquier eventualidad negativa y esto provoca otras consecuencias. Determinados grupos demográficos pueden convertirse en colectivos más vulnerables de la sociedad. Factores como la raza, el sexo, el nivel de estudios… etc pueden verse con un techo salarial y verse más afectados frente a las crisis económicas.    
    
## 2.- Integración y selección de los datos de interés a analizar.    
    
Se inicia la práctica con la lectura del ficheron de datos. Para ello, cargaremos los paquetes necesarios, cuyo número puede irse incrementando conforme avance el desarrollo de la práctica.    
    
#### Paquetes utilizados    
    
Se cargan fuera del rmarkdown, por problemas al ejecutar Knit.
La instalación de una librería seguiría los siguientes pasos (ejemplo)    
    
1) install.packages('dplyr')    
2) library ('dplyr')    
    
Paquetes utilizados en esta práctica    
    
* dplyr (manejo de dataframes)    
    

#### Lectura del fichero   
    
Se realiza la lectura con la función read.csv, indicando la coma como carácter separador y diciéndole que contamos con una primera fila de cabecera de columnas. A su vez, para mejorar la gestión de los datos, indicamos que las columnas de cadenas de caracteres, visualizados los datos, sean consideradas como tipo factor.   
    
```{r}

# fichero a cargar: ./data/adult_data.csv

datos <- read.csv (file.choose(), 
                   sep = ",", 
                   header = TRUE)

```
    
#### Dimensión del conjunto de datos    
    
```{r}
dim (datos)
```
    
#### Características de las variables leídas    
    
```{r}
str (datos)
```
    
Inspeccionamos 10 observaciones elegidas de manera aleatoria como ejemplo para ilustrar los datos con los que contamos.   
    
```{r}
set.seed(1) 
datos [sample (nrow (datos), 10), ]
```
    
## 3.- Limpieza de los datos.    
     
### 3.1.- ¿Los datos contienen ceros o elementos vacíos? ¿Cómo gestionarías cada uno de estos casos?    
    
Tras un análisis visual, y utilizando rstudio, se localizan datos perdidos. A continuación, pasamos a la revisión de las variables para su análisis y limpieza.    
    
```{r}
table (datos$age)
```
    
```{r}
table (datos$workclass)
```
```{r}
table (datos$education)
```
    
```{r}
table (datos$education.num)
```
    
```{r}
table (datos$marital.status)
```
    
```{r}
table (datos$occupation)
```
    
```{r}
table (datos$relationship)
```
    
```{r}
table (datos$race)
```
    
```{r}
table (datos$sex)
```
    
```{r}
table (datos$capital.gain)
```
    
```{r}
table (datos$capital.loss)
```
    
```{r}
table (datos$hours.per.week)
```
     
```{r}
table (datos$native.country)
```
     
```{r}
table (datos$salary)
```
     
Tras el análisis de las distintas variables, hemos encontrado valores '?', que consideramos como perdidos, en las siguientes variables    
* age    
* workclass    
* occupation    
* country    
    
Procedemos a sustituirlos. En el proceso de sustitución, encontramos que en todos los valores cadena de las distintas variables se ha insertado al inicio un espacio en blanco, incluido en el valor " ?".    
    
```{r}
datos [datos == " ?"] <- NA
```
    
Del total de datos leídos, los valores perdidos son        
    
```{r}
sum(is.na(datos))
```
y por columna   
    
```{r}
apply (is.na (datos), 
       2, 
       sum)
```
    
La media de valores perdidos por columna sería    
    
```{r}
apply (is.na (datos), 
       2, 
       mean)
```
    
Lo que es despreciable en el volumen total de datos, por lo que podemos eliminarlos.
    
```{r}
datos <- na.omit(datos)
```
    
Con lo que nuestro dataframe ha cambiado de dimensión.              
    
```{r}
dim (datos)
```
    
Se cambian las variables que empiezan por un espacio              
    
```{r}
datos$workclass <- trimws(datos$workclass, 
                          which = c("left"))
datos$education <- trimws(datos$education, 
                          which = c("left"))
datos$marital.status <- trimws(datos$marital.status, 
                               which = c("left"))
datos$occupation <- trimws(datos$occupation, 
                           which = c("left"))
datos$relationship <- trimws(datos$relationship, 
                             which = c("left"))
datos$race <- trimws(datos$race, 
                     which = c("left"))
datos$sex <- trimws(datos$sex, 
                    which = c("left"))
datos$salary <- trimws(datos$salary, 
                      which = c("left"))
```
              
### 3.2.- Identificación y tratamiento de valores extremos.    
    
    
```{r}

```
    
    
## 4.- Análisis de los datos.    

### 4.1.- Selección de los grupos de datos que se quieren analizar/comparar (planificación de los análisis a aplicar).    
    
    
### 4.2.- Comprobación de la normalidad y homogeneidad de la varianza.    

### 4.3.- Aplicación de pruebas estadísticas para comparar los grupos de datos. En función de los datos y el objetivo del estudio, aplicar pruebas de contraste de hipótesis, correlaciones, regresiones, etc. Aplicar al menos tres métodos de análisis diferentes.    
    
## 5.- Representación de los resultados a partir de tablas y gráficas.

## 6. Resolución del problema. A partir de los resultados obtenidos, ¿cuáles son las conclusiones? ¿Los resultados permiten responder al problema?    
    
## 7. Código: Hay que adjuntar el código, preferiblemente en R, con el que se ha realizado la limpieza, análisis y representación de los datos. Si lo preferís, también podéis trabajar en Python.          
          
-------------------------------------------------------------------------
-------------------------------------------------------------------------

#### Inclusión de una variable secuencial como identificador único de cada fila. Reordenación de columnas.    
    
```{r}
filas <- nrow (datos)

datos <- cbind (datos, 'id' = 1:filas)

names (datos)

datos <- subset (datos,
                 select = c(13,
                            1,
                            2,
                            3,
                            4,
                            5,
                            6,
                            7,
                            8,
                            9,
                            10,
                            11,
                            12))

names (datos)

```

    
#### La segmentación por rangos de edad te permite establecer nichos más concretos y a profundizar en el estudio.     

Establecimiento de categorías de edad para el estudio de empleabilidad vs salario en escalas    
* 0 a 16 años, cat_0    
* 17 a 20, cat_1    
* 21 a 34, cat_2    
* 35 a 45, cat_3    
* 46 a 65, cat_4    
* 65 ~, cat_5    

Fuente https://www.redalyc.org/journal/706/70666127005/html/    
    
```{r}
datos <- cbind (datos,
                age_cat = cut (datos$age,
                               breaks = c(0,
                                          16,
                                          20,
                                          34,
                                          45,
                                          65,
                                          150),
                               labels = c("cat_0",
                                          "cat_1",
                                          "cat_2",
                                          "cat_3",
                                          "cat_4",
                                          "cat_5"),
                               right = TRUE
                               ))
```




